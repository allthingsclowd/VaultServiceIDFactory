language: go
sudo: required
addons:
  apt:
    packages:
    - lynx
    - jq
    - curl
go:
- '1.10'
before_script:
- sudo rsync -az ${TRAVIS_BUILD_DIR}/ /usr/local/bootstrap/
- pushd packer
- if [ $VAGRANT_CLOUD_TOKEN ] ; then packer validate template.json ; fi
- popd
script:
- source ./var.env
- export LEADER_IP=127.0.0.1
- bash scripts/install_factory_service.sh
- sudo cp /usr/local/bin/VaultServiceIDFactory /home/travis/VaultServiceIDFactory
deploy:
  provider: releases
  api_key:
    secure: WR07DHJhwMLi9Xa43zZ7Q2jOWLRTY0GonZuLaSPImAs+Lkq1KSr2LhCRk6wnJWTWLIZ0F5KiSU6qy8BkxleB2V/EeDUGfnnwdCHoN5nv3zRsKvbfCcxe4kiKAjCwzeMj3KDbxYIpyMyrpA0WiJv1An76pYe5fUwNkqe5mDktH3lpdLUJOnm9EJO3euojKL5gjK9BkZ9jjLNRtuGV3X0qgENm7FaEr7Cz6yRwMp5vAJKiNo/2B3VdMXUu4OtcYz+xqWADM4yLVy3nmbnS0Ehq3l3ykGWpyzSumlQYHmtwh5rndQPrCko7pKBfGervTcgU56KDP0X0tXU6Fnh7Cyo96chdTAtdd3bmCaJlyyi3q/rNX5hUGylcGUiDFbuR6YOkz2q9lB06AyBavboznok9/HDaJJs6WsNB125u5oj6OAYnzA6CF44l/bPZkqSzsMnqRrs5gVdQ+sEfRzYtMUrvgVpVj89uD3JtHaNqeMrbJJL4U5EpE45Cq3jUsxX0fW8mi60b4Jcl193K7pLYKugIbw5rHS2niYFbOdm0Bp04+MnQ/U4/fUsKnPEq5zCrcohNJ6R+iJVi8U9LLjk1d1FRBY40smyvotb/OYyqd4MgrPUebILGajwNtiEVZGTnZrDuNZ3m4M1sub5azitMZh6ByVKxI6TPhForlHlXRkgeMVw=
  file_glob: true
  file:
  - "/usr/local/bin/VaultServiceIDFactory"
  skip_cleanup: true
  on:
    repo: allthingsclowd/VaultServiceIDFactory
    tags: true